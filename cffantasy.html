
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Fetch and display NFL team data</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="robots" content="noindex, nofollow">
    <meta name="googlebot" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1">



    <script
      type="text/javascript"
      src="/js/lib/dummy.js"
      
    ></script>



    <style id="compiled-css" type="text/css">
      
* {
  
  vertical-align: middle;
}

td {
  padding: 10px 5px 10px 5px;
}

      /* EOS */
    </style>

    <style type="text/css">
      :root {
        color-scheme: light;
      }
    </style>

    <script id="insert"></script>

  </head>
  <body>
    
<center>

<h1 style="display: inline-block;">Upset alert</h1>
<br>
<a href="https://stupid-fast.com/cf">College football scoreboard</a>
<br>
<p>Select the matchup most likely to result in an upset.
  <br>
  Each college football week starts on Monday.
</p>
<br>


<p id="loading"></p>


<table id="table"></table>

<ol id="ol">

</ol>
<main id="main"></main>

<dialog id="dia">
  <a href="javascript:" onclick="(function() { dia.close(); })()" style="display: block; text-align: right;">Close</a>
<select id="selectplayer" onchange="selectPlayer(this.value)">
  <option id="loadingthing" disabled>Select player...</option>
</select>
</dialog>

<iframe frameborder="0"></iframe>

</center>
  <script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"95d4af946c9a4d229ea725f950960b54","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
</body>

    <script type="text/javascript">

function getScoreboard() {
  return fetch(
    "https://site.api.espn.com/apis/site/v2/sports/football/college-football/scoreboard",
  )
    .then(function (res) {
      return res.json()
    })
    .then(function (games) {
      games = games.events
      //console.log("Games", games)
      return games.map(function (game) {
        let name = game.name
        let week = game.week.number
        game = game.competitions[0]
        game.name = name
        game.week = week
        game.competitors.forEach(function (team) {
          if (team.curatedRank.current > 25) {
            team.curatedRank.current = ""
          }
          game[team.homeAway] = team
        })
        return game
      })
    })
}

//https://script.google.com/macros/s/AKfycbymkB_0-cVqloMZ2iBRnjQ2rvpgoB1IKLWIAjFdaMHKK8vyZ0JBI0AZ49pbQY7_tBVU/exec

function getPlayers() {
  return fetch(
    "https://script.google.com/macros/s/AKfycbymkB_0-cVqloMZ2iBRnjQ2rvpgoB1IKLWIAjFdaMHKK8vyZ0JBI0AZ49pbQY7_tBVU/exec?PLAYERS",
  ).then(function (res) {
    return res.json()
  })
}

function getPicks() {
  return fetch(
    "https://script.google.com/macros/s/AKfycbymkB_0-cVqloMZ2iBRnjQ2rvpgoB1IKLWIAjFdaMHKK8vyZ0JBI0AZ49pbQY7_tBVU/exec?PICKS",
  ).then(function (res) {
    return res.json()
  })
}

//-------------------------

loading.innerText = "Loading players..."
getPlayers().then(function (players) {
  console.log("Players", players)
  loading.innerText = "Loading picks..."
  getPicks().then(function (picks) {
    console.log("Picks", picks)
    loading.innerText = "Loading games..."
    getScoreboard().then(function (games) {
      loading.innerText = ""
      //console.log("Games", games)
      games.forEach(function (game) {
        game.pick =
          picks.find(function (pick) {
            return pick.GAMEID == game.id
          })?.PLAYERID
      })
      console.log("Games", games)
      games.forEach(function (game) {
        let tr = table.insertRow()
        tr.insertCell().innerHTML = 
        "<img src='" + game.away.team.logo + "' width='25' />" + 
        "  <small>" + game.away.curatedRank.current + "</small> " + 
        game.away.team.shortDisplayName + 
        "<br>" + 
        "<img src='" + game.home.team.logo + "' width='25' />" + 
        "  <small>" + game.home.curatedRank.current + "</small> " + 
        game.home.team.shortDisplayName

        let td = tr.insertCell()
        let select = document.createElement("SELECT")
        let option = document.createElement("OPTION")
        select.add(option)
        select.onchange = function() {
          post(game.week, game.id, this.value, select.options[select.selectedIndex].text, game.name)
        }
        if (game.status.period > 0) {
          select.disabled = true
        }
        players.forEach(function(player) {
          let opt = document.createElement("OPTION")
          opt.text = player.NAME
          opt.value = player.ID
          select.add(opt)
        })
        select.value = game.pick
        td.append(select)
      })
    })
  })
})

function post(week, gameid, playerid, playername, gamename) {
  fetch("https://script.google.com/macros/s/AKfycbymkB_0-cVqloMZ2iBRnjQ2rvpgoB1IKLWIAjFdaMHKK8vyZ0JBI0AZ49pbQY7_tBVU/exec?PICKS", {
    method: "post",
    body: JSON.stringify([week, gameid, playerid, playername, gamename])
  })
}



  </script>

  <script>
    // tell the embed parent frame the height of the content
    if (window.parent && window.parent.parent){
      window.parent.parent.postMessage(["resultsFrame", {
        height: document.body.getBoundingClientRect().height,
        slug: "cfn9d1sm"
      }], "*")
    }

    // always overwrite window.name, in case users try to set it manually
    window.name = "result"
  </script>

  <script>
    const allLines = []
    const cssElement = document.querySelector("#compiled-css")

    window.addEventListener("message", (message) => {

      if (message.data.css){
        cssElement.textContent = message.data.css.payload
      }

      if (message.data.html){
        document.body.innerHTML = message.data.html.payload
      }
    })

    if (window.parent){
      window.parent.postMessage({loaded: true}, "*")
    }
  </script>
</html>
