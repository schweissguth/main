
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>College football fantasy</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="robots" content="noindex, nofollow">
    <meta name="googlebot" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1">



    <script
      type="text/javascript"
      src="/js/lib/dummy.js"
      
    ></script>



    <style id="compiled-css" type="text/css">
      center {
  margin: auto;
}

* {
  
  vertical-align: middle;
}

td {
  padding: 10px 5px 10px 5px;
}

      /* EOS */
    </style>

    <style type="text/css">
      :root {
        color-scheme: light;
      }
    </style>

    <script id="insert"></script>

  </head>
  <body>
    
<center>
  <link rel="stylesheet" href="https://stupid-fast.com/css.css">

<h1 style="display: inline-block;">üèà CF calc</h1>

<table>
  <thead>
    <tr>
      <th>Week</th>
      <th></th>
      <th></th>
      <th>Upset?</th>
      <th>Spread</th>
      <th colspan="2">Ranks</th>
      <th colspan="2">Scores</th>
    </tr>
  </thead>
  <tbody id="table"></tbody>
</table>


<button onclick="submitResults()">Submit results</button>

<iframe frameborder="0"></iframe>

</center>
  <script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"95d4af946c9a4d229ea725f950960b54","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
</body>

    <script type="text/javascript">

Array.prototype.makeObj = function () {
  let header = this.shift()
  return this.map(function (each) {
    let obj = {}
    for (let i = 0; i < header.length; i++) {
      obj[header[i]] = each[i] || null
    }
    return obj
  })
}

function getScoreboard() {
  return fetch(
    "https://site.api.espn.com/apis/site/v2/sports/football/college-football/scoreboard",
  )
    .then(function (res) {
      return res.json()
    })
    .then(function (games) {
      games = games.events
      //console.log("Games", games)
      return games.map(function (game) {
        let name = game.name
        let week = game.week.number
        game = game.competitions[0]
        game.name = name
        game.week = week
        game.competitors.forEach(function (team) {
          if (team.curatedRank.current > 25) {
            team.curatedRank.current = 99
          }
          game[team.homeAway] = team
        })
        return game
      })
    })
}

function getPlayers() {
  return fetch(
    "https://sheets.googleapis.com/v4/spreadsheets/1DJ0d2YDxPNN38v7uCgU-Netkvl-betAGEvM8TsCOBGw/values/PLAYERS?key=AIzaSyDIEdL4EcBenrWDkh03oFYmFvHT_VNH3AI",
  )
    .then(function (res) {
      return res.json()
    })
    .then(function (res) {
      return res.values.makeObj()
    })
}

function getPicks() {
  return fetch(
    "https://sheets.googleapis.com/v4/spreadsheets/1DJ0d2YDxPNN38v7uCgU-Netkvl-betAGEvM8TsCOBGw/values/PICKS?key=AIzaSyDIEdL4EcBenrWDkh03oFYmFvHT_VNH3AI",
  )
    .then(function (res) {
      return res.json()
    })
    .then(function (res) {
      return res.values.makeObj()
    })
}

function post(arr) {
  fetch(
    "https://script.google.com/macros/s/AKfycbymkB_0-cVqloMZ2iBRnjQ2rvpgoB1IKLWIAjFdaMHKK8vyZ0JBI0AZ49pbQY7_tBVU/exec?RESULTS",
    {
      method: "post",
      body: JSON.stringify(arr),
    },
  ).then(function(res) {
    alert("Success")
  })
}

//-------------------------


let ARR = []

  table.innerHTML = null
  getPlayers().then(function (players) {
    console.log("Players", players)
    getPicks().then(function (picks) {
      console.log("Picks", picks)
      getScoreboard().then(function (games) {
        //console.log("Games", games)
        games.forEach(function (game) {
          game.pick = picks.findLast(function (pick) {
            return pick.GAMEID == game.id
          })?.PLAYERID
        })
        games = games.filter(function(game) {
          return game.pick
        })
        console.log("Games", games)
        games.forEach(function(game, index) {
          let awayrank = Math.round(game.away.curatedRank.current)
          let homerank = Math.round(game.home.curatedRank.current)
          let awayscore = Math.round(game.away.score)
          let homescore = Math.round(game.home.score)
          let upset = false
          if (awayrank > homerank && awayscore > homescore) {
            console.log("ipset1")
            upset = true
          } else if ((homerank > awayrank) && (homescore > awayscore)) {
            console.log("ipset2")
            upset = true
          }

          let spread = Math.abs(game.away.score - game.home.score)
          let tr = table.insertRow()
          tr.insertCell().innerText = game.week
          tr.insertCell().innerText = game.pick
          tr.insertCell().innerText = game.name
          tr.insertCell().innerText = upset
          tr.insertCell().innerText = spread
          tr.insertCell().innerText = awayrank
          tr.insertCell().innerText = homerank
          tr.insertCell().innerText = awayscore
          tr.insertCell().innerText = homescore

          ARR.push([game.week, game.id, game.pick, spread, upset, awayrank, homerank, awayscore, homescore, game.name, +upset])

        })

      })
    })
  })


  function submitResults() {
    post(ARR)
  }



  </script>

  <script>
    // tell the embed parent frame the height of the content
    if (window.parent && window.parent.parent){
      window.parent.parent.postMessage(["resultsFrame", {
        height: document.body.getBoundingClientRect().height,
        slug: "cfn9d1sm"
      }], "*")
    }

    // always overwrite window.name, in case users try to set it manually
    window.name = "result"
  </script>

  <script>
    const allLines = []
    const cssElement = document.querySelector("#compiled-css")

    window.addEventListener("message", (message) => {

      if (message.data.css){
        cssElement.textContent = message.data.css.payload
      }

      if (message.data.html){
        document.body.innerHTML = message.data.html.payload
      }
    })

    if (window.parent){
      window.parent.postMessage({loaded: true}, "*")
    }
  </script>
</html>
