<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <title>Picks - StupidFast.com</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta name="robots" content="noindex, nofollow" />
    <meta name="googlebot" content="noindex, nofollow" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <script
      type="text/javascript"
      src="https://stupid-fast.com/library.js"
    ></script>
    <link
      rel="stylesheet"
      type="text/css"
      href="https://stupid-fast.com/css.css"
    />
  </head>
  <body>
    <center>
      <br /><br />
      <a href="https://stupid-fast.com">
        <img src="https://stupid-fast.com/sfbanner.png" />
      </a>
      <br /><br />

      <table id="table" cellpadding="3">
        <tr>
          <th>LOADING...</th>
        </tr>
      </table>
    </center>
  </body>

  <script type="text/javascript">
    getPickorder().then(function (pickorder) {
      getStandings().then(function (standings) {
        console.log(standings)
        table.innerHTML = ""
        standings.sort(function (a, b) {
          return a.position - b.position
        })
        standings.forEach(function (standing) {
          let tr = table.insertRow()

          let td = tr.insertCell()
          let img = document.createElement("IMG")
          img.src = "https://cf.nascar.com/data/images/carbadges/1/" + standing.car_no + ".png"
          img.width = "50"
          img.alt = ""
          td.append(img)

          tr.insertCell().innerText = standing.driver_name

          td = tr.insertCell()
          let select = document.createElement("SELECT")
          let option = document.createElement("OPTION")
          option.text = ""
          select.add(option)
          pickorder.forEach(function (picker) {
            let opt = document.createElement("OPTION")
            opt.text = picker.playername
            opt.value = picker.PLAYERID
            select.add(opt)
          })
          select.onchange = function() {
            fetch("https://script.google.com/macros/s/AKfycbyEGYd3C0Zgd-mHbBrjDrdMUSsYvj_7oky1yIuffDrRk8rURlR-gV_IteIJHzznntfO/exec?PICKS", {
              method: "post",
              body: JSON.stringify({
                RACEID: standing.raceid,
                DRIVERID: standing.driver_id,
                PLAYERID: this.value
              })
            })
          }
          select.value = standing.pick
          td.append(select)
        })
        let tr13 = table.insertRow(13)
        let td13 = tr13.insertCell()
        td13.setAttribute("colspan", 10)
        td13.innerHTML = "<br><hr><br>"
      })
    })
  </script>
</html>
