<!DOCTYPE html>
<html>

<head>
  
    <title>Picks - StupidFast.com</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  
    <script src="https://stupid-fast.com/server.js"></script>
    <script>
        function getGroupLines(x) {
            return fetch(
                "https://sheets.googleapis.com/v4/spreadsheets/1jwadkJYYfBmf-SbjUokDV0S_yzC7gD39-jHxVatJfLU/values/PICKS?key=AIzaSyDIEdL4EcBenrWDkh03oFYmFvHT_VNH3AI",
            )
                .then(function (res) {
                    return res.json()
                })
                .then(function (res) {
                    if (x) {
                        return res.values.makeObj().filter(function (filter) {
                            return filter.RACEID == x
                        })
                    } else {
                        return res.values.makeObj()
                    }
                })
        }
    </script>
</head>

<body>

    <header>
        <a href="./index.html">Home</a>
    </header>


    <main id="main">
    </main>
</body>

<script>

    const url = new URL(window.location.href);
    const params = new URLSearchParams(url.search)
    const playerid = params.get('playerid')

    nextRace().then(function (res) {
        const raceid = res
        getStandings().then(function (res) {
            console.log(res)
            res.forEach(function (each) {
                let span = document.createElement('span')
                span.title = each.driver_id
                let lbl = document.createElement('label')
                lbl.style.display = "table";
                span.innerText = each.driver_name + " "
                let cb = document.createElement('input')
                cb.id = each.driver_id
                cb.type = "checkbox"
                cb.disabled = true
                cb.onchange = function () {
                    let arr = [raceid, each.driver_id, playerid, each.driver_name]
                    if (!cb.checked) {
                        arr[2] = ""
                    }
                    fetch("https://script.google.com/macros/s/AKfycbyEGYd3C0Zgd-mHbBrjDrdMUSsYvj_7oky1yIuffDrRk8rURlR-gV_IteIJHzznntfO/exec?PICKS", {
                        method: 'POST',
                        body: JSON.stringify([arr]),
                    }).then(function (res) {
                        return res.text()
                    }).then(function (res) {
                        console.log(res)
                    })
                }
                lbl.appendChild(cb)
                lbl.appendChild(span)
                main.appendChild(lbl)
            })
            getGroupLines().then(function (res) {

            })
        })
        getPicks().then(function (res) {
            res = res.filter(function (each) {
                return each.RACEID == raceid
            })
            console.log(res)
            res.forEach(function (each) {
                let cb = document.getElementById(each.DRIVERID)
                if (each.PLAYERID == playerid) {
                    cb.checked = true
                    cb.disabled = false
                } else if (each.PLAYERID) {
                    cb.checked = true
                    
                } else {
                    cb.checked = false
                    cb.disabled = false
                }
            })
        })
    });
    


</script>

</html>
