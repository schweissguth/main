
<!DOCTYPE html>
<html>

<head>
    <title>Stupid-Fast.com - Make Picks</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="robots" content="noindex, nofollow">
    <meta name="googlebot" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://stupid-fast.com/server.js"></script>
    <link rel="stylesheet" type="text/css" href="./css.css" />

</head>

<body>
    <header>
        <a href="./index.html"><img src="./sfbanner.png" alt="" /></a>
    </header>

    <section>
        <span id="spanplayerid">Hello, </span>! <a href="./players.html" style="display: inline;"
            onclick="localStorage.removeItem('playerid')">Log out</a>?
    </section>
    <main id="main"></main>

    <script>
        const url = new URL(window.location.href);
        const params = new URLSearchParams(url.search);
        const playerid = params.get('player');
        console.log(playerid)
        if (!playerid) {
            window.location.href = './players.html';
        }
        spanplayerid.innerText += playerid.toUpperCase();


        async function init() {
            const raceid = await nextRace()
            const groupobj = await groupObj()
            const groupid = groupobj[raceid][playerid].group
            const standings = await getStandings()
            const picks = await getPicks(raceid)
            console.log(picks)

            standings.forEach(function (driver) {
                let label = document.createElement("LABEL")
                let cb = document.createElement("INPUT")
                let img = document.createElement("IMG")
                let span = document.createElement("SPAN")

                label.style.display = "block"
                label.style.textAlign = "left"

                cb.type = "checkbox"
                cb.style.scale = "1.25"
                cb.id = driver.driver_id
                cb.disabled = false
                cb.onchange = function () {
                    let player = playerid
                    if (!this.checked) player = ""
                    let arr = [Date.now(), raceid, groupid, driver.driver_id, player]
                    fetch("https://script.google.com/macros/s/AKfycbyEGYd3C0Zgd-mHbBrjDrdMUSsYvj_7oky1yIuffDrRk8rURlR-gV_IteIJHzznntfO/exec?PICKS", {
                        method: "post",
                        body: JSON.stringify([arr])
                    })
                }

                img.src = "https://cf.nascar.com/data/images/carbadges/1/" + driver.car_no + ".png"
                img.alt = ""
                img.style.verticalAlign = "middle"
                img.width = 65

                span.innerText = driver.driver_name

                label.append(cb)
                label.append(img)
                label.append(span)
                main.append(label)





            })
            
            let filter = picks.filter(function (pick) {
            return pick.GROUPID == groupid
            })

            filter.forEach(function (pick) {
                let cb = document.getElementById(pick.DRIVERID)
                console.log(cb)
                cb.checked = pick.PLAYERID || false
                if (pick.PLAYERID != playerid) cb.disabled = true
                if (!pick.PLAYERID) cb.disabled = false
                if (pick.PLAYERID == playerid) cb.disabled = false
            })

            document.querySelectorAll("LABEL")[10].before(document.createElement("HR"))


        }

        init()

    </script>

</body>









</html>
