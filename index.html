<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Stupid-Fast.com</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="robots" content="noindex, nofollow">
  <meta name="googlebot" content="noindex, nofollow">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="./server.js"></script>

  <link rel="stylesheet" type="text/css" href="./css.css" />


</head>

<body>
  <header>
    <a href="./index.html"><img src="./sfbanner.png" alt="" /></a>
  </header>
  

  <a href="./picks.html" class="heading">Click HERE to Make Picks</a>
  <a href="https://www.driveraverages.com/">DriverAverages.com</a>
  <a href="https://stupid-fast.com/results">Results and schedule</a>
  <a href="https://stupid-fast.com/rules">Rules and info</a>
  <a href="https://stupid-fast.com/season" class="heading">Season standings</a>
  <a href="https://stupid-fast.com/chase" class="heading">Chase standings</a>

  <center>
    <table id="t1" cellpadding="5></table>
  </center>

  <br><br>

  <p id="TRACK"></p>
  <p id="BROADCAST"></p>
  <p id="RADIO"></p>
  <p id="LAPS"></p>
  <p id="STAGE"></p>

  <br>

  <table id="t2" cellpadding="3">
    <tr>
      <th>LOADING...</th>
    </tr>
  </table>

  <br><br>

  <table id="LAPNOTES" cellpadding="3"></table>



  <script type="text/javascript">
  async function table1() {
  const raceid = await nextRace()
  const prevrace = await prevRace()
  const groups = await getGroups()
  const pickorder = await pickorderobj(raceid)
  const players = await playersobj()
  const scores = await playerscoresobj(prevrace)
  const picks = await playerpicksobj(raceid)
  const drivers = await driversobj()

  pickorder.forEach(function(pickers, i) {
    let tbody = t1.createTBody()
    let tr = tbody.insertRow()
    let th = document.createElement("TH")
    th.innerText = groups[i].TITLE
    th.setAttribute("colspan", 2)
    tr.append(th)
    pickers.forEach(function(picker) {
      let tr = tbody.insertRow()
      tr.id = picker.id
      tr.insertCell().innerHTML = players[picker.id].NAME + " <small>" + scores[picker.id].total + "</small>"
      let td = tr.insertCell()
      picks[picker.id].forEach(function(each) {
        td.innerHTML += "<div>" + drivers[each].name + "</div>"
      })
    })
  })

} 
    table1()
/*
    function table2() {
      
      getRunningOrder().then(function (res) {
        //console.log(res)
        t2.innerHTML = ""
        res[0].drivers.forEach(function (driver) {
          let tr = t2.insertRow()
          tr.insertCell().innerText = driver.pos
          tr.insertCell().innerHTML = driver.name
            + " <small>" + (driver.delta.toFixed(2) || "") + "</small>"
          let td = tr.insertCell()
          td.id = driver.id
        })
        res.forEach(function (group) {
          group.drivers.forEach(function (driver) {
            let div = document.createElement("SMALL")
            div.style.display = "block"
            div.innerHTML = driver.playername || "&nbsp;"
            if (driver.score) div.innerText += " - " + driver.score
            document.getElementById(driver.id).append(div)
          })
        })
      })
    }
    table2()
*/


    function feed() {
      getLiveFeed().then(function (liverace) {
        //console.log("liverace", liverace)
        TRACK.innerHTML = "<u>" + liverace.track_name.toUpperCase() + "</u>"
        LAPS.innerText =
          "Lap " +
          liverace.lap_number +
          " of " +
          liverace.laps_in_race +
          " (" +
          liverace.laps_to_go +
          " laps to go)"
        let flags = [, "üü¢", "üü°", , "üèÅ", , , , "üè¥", "üèÅ"]
        STAGE.innerHTML =
          "Stage " +
          liverace.stage.stage_num +
          " <big>" +
          flags[liverace.flag_state] +
          "</big> flag"
        getSchedule().then(function (schedule) {
          let findrace = schedule.find(function (schedule) {
            return schedule.race_id == liverace.race_id
          })
          BROADCAST.innerText =
            findrace.television_broadcaster + " / " + findrace.radio_broadcaster
        })
      })

      getLapNotes().then(function (notes) {
        console.log("Notes", notes)
        LAPNOTES.innerHTML = null
        notes = Object.entries(notes)
        notes.reverse().forEach(function (note) {
          let tr = LAPNOTES.insertRow()
          tr.insertCell().innerText = note[0]
          tr.insertCell().innerText = note[1][0].Note
        })
      })
    }
    feed()

    setInterval(function () {
      feed()
      table2()
    }, 30000)




  </script>


</body>




</html>
